<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="edu.project.mapper.boardMapper">
	<insert id="boardInsert" parameterType="boardVo">
		INSERT INTO boardtable(
		bidx
		, title
		, content
		, wdate
		, hit
		, hashTag
		, filename
		, likes
		, uidx
		,
		bDelYn
		, writer

		)VALUES(
		pbidx_seq.nextval
		, #{title}
		, #{content}
		, sysdate
		, 0
		, #{hashTag}
		, 'hi'
		, 0
		, #{uidx}
		, 'N'
		, #{writer}
		)
	</insert>

	<select id="boardList" resultType="boardVo" parameterType="scri">
		SELECT * FROM (
		SELECT ROWNUM AS rnum, A.* FROM (
		SELECT * FROM boardtable
		<include refid="search"></include>
		ORDER BY bidx DESC
		)A
		) WHERE rnum BETWEEN #{rowStart} AND #{rowEnd}
	</select>

	<select id="listCount" resultType="int">
		SELECT count(bidx)
		from boardtable
		<include refid="search"></include>
		WHERE bidx > 0
	</select>

	<sql id="search">
		<if test="searchType == 'title'">
			WHERE title like '%'||#{keyword}||'%'
		</if>
		<if test="searchType == 'content'">
			WHERE content like '%'||#{keyword}||'%'
		</if>
	</sql>

	<select id="selectByBidx" parameterType="int"
		resultType="boardVo">
		SELECT bidx
		, title
		, content
		, hashTag
		, uidx
		, hit
		FROM
		boardtable
		WHERE bidx = #{bidx}
	</select>

	<select id="updateByBidx" parameterType="int"
		resultType="boardVo">
		SELECT bidx
		, title
		, content
		, hashTag
		, uidx
		, hit
		FROM boardtable
		WHERE bidx = #{bidx}
	</select>

	<update id="modifyByBidx" parameterType="boardVo">
		UPDATE boardtable
		SET
		title
		= #{title}
		, content = #{content}
		, hashTag = #{hashTag}
		WHERE bidx
		= #{bidx}
	</update>

	<delete id="deleteByBidx" parameterType="int">
		DELETE FROM boardtable
		WHERE bidx = #{bidx}
	</delete>

	<select id="replyList" parameterType="int" resultType="replyVo">
		SELECT *
		FROM replytable WHERE bidx=#{bidx} and rDelYn = 'N';
	</select>

	<insert id="insertReply" parameterType="replyVo">
		INSERT INTO replytable(
		ridx
		, rcontent
		, redate
		, uidx
		, bidx
		, rDelYn
		)VALUES(
		pridx_seq.NEXTVAL
		, #{rcontent}
		, SYSDATE
		, #{uidx}
		, #{bidx}
		, 'N'
		)
	</insert>
	
	<update id="updateReply" parameterType="replyVo">
		UPDATE replytable
		SET 
		rcontent = #{rcontent}
		WHERE ridx = #{ridx}
	</update>
	
	<delete id="deleteReply" parameterType="int">
		DELETE FROM replytable WHERE ridx = #{ridx}
	</delete>

</mapper>